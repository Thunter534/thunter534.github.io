<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Marking Assistant</title>
  <style>
    /* Modern Dark Theme */
    body { 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
      max-width: 600px; 
      margin: 60px auto; 
      background-color: #121212; 
      color: #e0e0e0; 
      line-height: 1.6;
      padding: 20px;
    }

    h1 { 
      color: #ffffff; 
      font-weight: 600; 
      margin-bottom: 30px; 
      letter-spacing: -0.5px;
    }

    label { 
      display: block; 
      margin-bottom: 8px; 
      font-size: 0.85rem; 
      color: #999; 
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    input, select, textarea { 
      width: 100%; 
      margin-bottom: 24px; 
      padding: 12px; 
      background-color: #1e1e1e; 
      border: 1px solid #333; 
      border-radius: 8px; 
      color: #fff; 
      box-sizing: border-box; 
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #4a90e2;
      background-color: #252525;
    }

    button { 
      width: 100%;
      background-color: #ffffff; 
      color: #000; 
      border: none; 
      padding: 14px; 
      border-radius: 8px; 
      font-weight: 600; 
      font-size: 1rem;
      cursor: pointer; 
      transition: transform 0.1s, background-color 0.2s;
    }

    button:hover { 
      background-color: #d1d1d1; 
    }

    button:active {
      transform: scale(0.98);
    }

    #status { 
      margin-top: 20px; 
      font-size: 0.9rem; 
      color: #4a90e2; 
      text-align: center;
      font-weight: 500;
      min-height: 1.2em;
    }

    #result { 
      white-space: pre-wrap; 
      margin-top: 25px; 
      background: #1e1e1e; 
      padding: 20px; 
      border-radius: 12px; 
      border: 1px solid #333;
      font-family: 'Menlo', 'Monaco', monospace;
      font-size: 0.9rem;
      color: #ccc;
      display: none; 
    }
  </style>
</head>
<body>

  <h1>AI Marking Assistant</h1>

  <label for="assignment">Assignment Title</label>
  <input id="assignment" placeholder="e.g. Year 10 History Essay" />

  <label for="rubric">Rubric Type</label>
  <select id="rubric">
    <option value="essay">Essay (Analysis & Structure)</option>
    <option value="short_answer">Short Answer (Accuracy & Conciseness)</option>
  </select>

  <label for="student_work">Student Work</label>
  <textarea id="student_work" rows="10" placeholder="Paste student submission here..."></textarea>

  <button onclick="submitWork()">Submit for Assessment</button>

  <div id="status"></div>
  <pre id="result"></pre>

<script>
  async function submitWork() {
    const statusDiv = document.getElementById("status");
    const resultDiv = document.getElementById("result");
    
    statusDiv.innerText = "Processing assessment...";
    resultDiv.style.display = "none";

    const data = {
      assignment: document.getElementById("assignment").value,
      rubric: document.getElementById("rubric").value,
      student_work: document.getElementById("student_work").value
    };

    try {
      const response = await fetch(
        "https://thunter0116.app.n8n.cloud/webhook-test/843732eb-f3ca-45c7-b841-08cd7131944c",
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        }
      );

      if (!response.ok) throw new Error("Server error");

      const res = await response.json();
      // n8n often sends an array, so we grab the first item if it is one
      const info = Array.isArray(res) ? res[0] : res;

      // START FORMATTING THE REPORT
      let report = "";

      if (info.error) {
        report = `âŒ ERROR\n\n${info.error}\n\nACTION: ${info.action_needed}`;
      } else if (info.analysis && info.rating) {
        // Build a beautiful structured report from the JSON you provided
        report += `OVERALL RATING: ${info.rating.overall_score} (${info.rating.overall_rating_text})\n`;
        report += `====================================\n\n`;
        report += `SUMMARY:\n${info.analysis.overall_feedback}\n\n`;
        report += `DETAILED BREAKDOWN:\n`;
        
        info.analysis.criterion_breakdown.forEach(item => {
          report += `\nðŸ”¸ ${item.name.toUpperCase()}\n`;
          report += `   Level: ${item.level_achieved}\n`;
          report += `   Feedback: ${item.feedback}\n`;
        });
      } else {
        // Fallback if the JSON structure is different
        report = typeof info === 'string' ? info : JSON.stringify(info, null, 2);
      }

      statusDiv.innerText = "Assessment Complete";
      resultDiv.innerText = report;
      resultDiv.style.display = "block";

    } catch (error) {
      statusDiv.innerText = "Error: Connection failed.";
      console.error(error);
    }
  }
</script>

</body>
</html>
